dist: xenial
language: node_js
cache: npm
branches:
    only:
        - master
env:
    global:
        # List of all touched files, excluding paths starting with 'packages'
        - CHANGED_GLOBAL_FILES=$(git diff --name-only $TRAVIS_COMMIT_RANGE | grep -v "^packages")
        # Build only touched packages for pull requests when no shared files were touched
        - PARTIAL_BUILD=$(if [ "$CHANGED_GLOBAL_FILES" == "" ] && [ "$TRAVIS_PULL_REQUEST" != "false" ]; then echo "true"; else echo "false"; fi)
        # Set arguments so lerna only runs scripts in changed packages
        - SCRIPT_ARGS=$(if [ "$PARTIAL_BUILD" = "true" ]; then echo "--since $TRAVIS_BRANCH"; else echo ""; fi)
before_script:
    - echo $TRAVIS_COMMIT_RANGE
    - echo $CHANGED_GLOBAL_FILES
    - echo $PARTIAL_BUILD
    - echo $SCRIPT_ARGS

matrix:
    include:
        - name: "Linux Job"
          script:
              - npm run lint -- $SCRIPT_ARGS
              - npm run build -- $SCRIPT_ARGS
              - npm test -- $SCRIPT_ARGS
        - name: "Windows Job"
          os: windows
          script:
              - npm run lint -- $SCRIPT_ARGS
              - npm run build -- $SCRIPT_ARGS
              - npm test -- $SCRIPT_ARGS
        - name: "MacOSX Job"
          language: objective-c
          os: osx
          osx_image: xcode11.2
          script:
              - npm run test:native -- $SCRIPT_ARGS
